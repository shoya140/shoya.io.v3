<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <meta name="description" content="Shoya Ishimaru (shoya140)'s weblog about his input/output.">
    <meta name="author" href="https://plus.google.com/u/0/102413339779614193497/posts">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="google-site-verification" content="sFx-iJWT2iihts7-5wK7CnR03-MymfWXmn_7KNoyIz0" />
    <meta property="og:title" content="shoya.io">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://shoya.io/page6/index.html">
    
        <meta property="og:image" content="http://shoya.io/assets/img/icon_laptop.png">
    
    <title>shoya.io</title>

    <link rel="alternate" type="application/rss+xml" title="shoya.io" href="http://shoya.io/feed.xml">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="http://shoya.io/page6/">
    <link rel="shortcut icon" href="http://shoya.io/assets/img/favicon.ico">

    <script type="text/javascript" src="/assets/js/jquery.1.10.2.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.color.js"></script>
    <script type="text/javascript" src="/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/assets/js/star.js"></script>
    <script type="text/javascript">Hatena.Star.Token = 'd2f3ada92845cdc5beeb7325518464d39adf9e88';</script>
    <script src="/assets/js/main.js"></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a href="/"><img class="logo" src="/assets/img/logo.png"></a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
          <a class="page-link" href="/blog/">Blog</a>
          <a class="page-link" href="/research/">Research</a>
          <a class="page-link" href="/development/">Development</a>
          <a class="page-link" href="/aboutme/">About</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="wrapper-inside">
          
<div class="post">
  <header class="post-header">
    <p class="post-meta">Aug 26, 2014
    
    [<a href="/tag/Programming/">Programming</a>]
    
    </p>
    <a href="/blog/tornado_debug/"><h1 class="post-title">Tornadoのデバッグモードを有効にする</h1></a>
  </header>
  <article class="post-content">
    <p>Tornadoには多くのWebアプリフレームワーク同様にデバックモードがある。これを有効にすることで、pythonコードの更新をサーバの再起動なしに反映させたり、ファイルのキャッシュを無効にしたり、tracebackをブラウザ上に表示したりといった機能を利用することができる。</p>

<p>デバッグモードを有効にするには、tornado.web.Applicationのインスタンス作成時にhandlersと一緒にdebug=Trueを付加すれば良い。</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">app</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[(</span><span class="s">r&quot;/&quot;</span><span class="p">,</span>  <span class="n">IndexHandler</span><span class="p">)],</span> <span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span></code></pre></div>

<p>Applicationクラスを作る場合はsettingsにディクショナリで指定する。</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Application</span><span class="p">(</span><span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="n">Board</span><span class="p">()</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">r&quot;/&quot;</span><span class="p">,</span> <span class="n">IndexHander</span><span class="p">),</span>
            <span class="p">(</span><span class="s">r&quot;/socket&quot;</span><span class="p">,</span> <span class="n">SocketHandler</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;debug&quot;</span><span class="p">:</span><span class="n">options</span><span class="o">.</span><span class="n">debug</span><span class="p">}</span>
        <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handlers</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span></code></pre></div>

<p>自分は下記のようにtornado.optionsを使ってport, debugの２つをコマンドラインから入力できるようにしておき、本番環境と開発環境を簡単に切り替えられるようにしている。</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">tornado.options</span> <span class="kn">import</span> <span class="n">define</span><span class="p">,</span> <span class="n">options</span>
<span class="n">define</span><span class="p">(</span><span class="s">&quot;port&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;run on the given port&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">define</span><span class="p">(</span><span class="s">&quot;debug&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;run the server in debug mode&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">tornado</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">parse_command_line</span><span class="p">()</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[(</span><span class="s">r&quot;/&quot;</span><span class="p">,</span>  <span class="n">IndexHandler</span><span class="p">)],</span> <span class="n">debug</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
    <span class="n">http_server</span> <span class="o">=</span> <span class="n">tornado</span><span class="o">.</span><span class="n">httpserver</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">http_server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
    <span class="n">tornado</span><span class="o">.</span><span class="n">ioloop</span><span class="o">.</span><span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></code></pre></div>


  </article>
  <div class="post-social">
    <div class="tweet-button"><a href="https://twitter.com/share?text=Tornado%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%A2%E3%83%BC%E3%83%89%E3%82%92%E6%9C%89%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B%20-%20shoya.io&amp;url=http://shoya.io/blog/tornado_debug/"><span class="lsf" style="font-size:20px;">twitter</span> tweet
  </a></div>
    <div class="facebook-button"><a href="http://www.facebook.com/sharer.php?u=http://shoya.io/blog/tornado_debug/&amp;t=Tornado%E3%81%AE%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%83%A2%E3%83%BC%E3%83%89%E3%82%92%E6%9C%89%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B" onClick="window.open(encodeURI(decodeURI(this.href)), 'sharewindow', 'width=550, height=450, personalbar=0, toolbar=0, scrollbars=1, resizable=!'); return false;"><span class="lsf" style="font-size:20px;">facebook</span> share
  </a></div>
    <div class="hatenabookmark-button"><a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=http://shoya.io/blog/tornado_debug/"><span class="lsf" style="font-size:20px;">hatenabookmark</span> bookmark
  </a></div>
    <div class="hatena-star"><a href="http://shoya.io/blog/tornado_debug/" style="display: none;">hatena</a></div>
  </div>
</div>
<hr>

<div class="post">
  <header class="post-header">
    <p class="post-meta">Aug 25, 2014
    
    [<a href="/tag/Infrastructure/">Infrastructure</a>]
    
    </p>
    <a href="/blog/nginx_root/"><h1 class="post-title">Nginxの静的ファイル配信でハマった</h1></a>
  </header>
  <article class="post-content">
    <p>静的ファイルに限った話ではないけれど、Nginxのlocationに応じたrootの設定でつまずいたのでメモ。<a href="http://www.oreilly.co.jp/books/9784873115764/">概説Tornado</a>の中に「静的リソースはアプリケーションにリクエストをプロキシするのではなくNginxに捌かせるほうがアプリケーションの不要な負担を取り除けて有用」という説明があったので、staticディレクトリへのルーティング設定をNginxに書いた。</p>

<div class="highlight"><pre><code class="language-nginx" data-lang="nginx"><span class="k">location</span> <span class="s">/static/</span> <span class="p">{</span>
    <span class="kn">root</span> <span class="s">/path/to/app/static</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>上記のように書きたいところだがこれは間違いで</p>

<div class="highlight"><pre><code class="language-nginx" data-lang="nginx"><span class="k">location</span> <span class="s">/static/</span> <span class="p">{</span>
    <span class="kn">root</span> <span class="s">/path/to/app</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>正しくはこちら。</p>

<p>rootはstaticディレクトリのrootを指すのではなく、アプリケーションのroot。/static/はURLとして生きているので、/static/を含めたパスでファイルへ届くように書く必要がある。</p>

<p>(備考)アプリケーション全体のnginx設定ファイルはこんな感じ。各アプリケーションごとに設定ファイルを分けてconf.d/以下に保存しておき、nginx.confでそれらをインポートしている。</p>

<div class="highlight"><pre><code class="language-nginx" data-lang="nginx"><span class="k">upstream</span> <span class="s">paletta</span><span class="p">{</span>
    <span class="kn">server</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">8011</span><span class="p">;</span>
    <span class="kn">server</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">8012</span><span class="p">;</span>
    <span class="kn">server</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">8013</span><span class="p">;</span>
    <span class="kn">server</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">8014</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">paletta.mrk1869.com</span><span class="p">;</span>

    <span class="kn">access_log</span>  <span class="s">/home/web/log/nginx/paletta.mrk1869.com/access.log</span> <span class="s">ltsv</span><span class="p">;</span>
    <span class="kn">location</span> <span class="s">/static/</span> <span class="p">{</span>
        <span class="kn">root</span> <span class="s">/home/web/paletta/app</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass_header</span> <span class="s">Server</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$http_host</span><span class="p">;</span>
        <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Scheme</span> <span class="nv">$scheme</span><span class="p">;</span>
        <span class="kn">proxy_pass</span> <span class="s">http://paletta</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>


  </article>
  <div class="post-social">
    <div class="tweet-button"><a href="https://twitter.com/share?text=Nginx%E3%81%AE%E9%9D%99%E7%9A%84%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E9%85%8D%E4%BF%A1%E3%81%A7%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F%20-%20shoya.io&amp;url=http://shoya.io/blog/nginx_root/"><span class="lsf" style="font-size:20px;">twitter</span> tweet
  </a></div>
    <div class="facebook-button"><a href="http://www.facebook.com/sharer.php?u=http://shoya.io/blog/nginx_root/&amp;t=Nginx%E3%81%AE%E9%9D%99%E7%9A%84%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E9%85%8D%E4%BF%A1%E3%81%A7%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F" onClick="window.open(encodeURI(decodeURI(this.href)), 'sharewindow', 'width=550, height=450, personalbar=0, toolbar=0, scrollbars=1, resizable=!'); return false;"><span class="lsf" style="font-size:20px;">facebook</span> share
  </a></div>
    <div class="hatenabookmark-button"><a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=http://shoya.io/blog/nginx_root/"><span class="lsf" style="font-size:20px;">hatenabookmark</span> bookmark
  </a></div>
    <div class="hatena-star"><a href="http://shoya.io/blog/nginx_root/" style="display: none;">hatena</a></div>
  </div>
</div>
<hr>

<div class="post">
  <header class="post-header">
    <p class="post-meta">Jul 12, 2014
    
    [<a href="/tag/Note/">Note</a>]
    
    </p>
    <a href="/blog/github_academic/"><h1 class="post-title">GitHubの学割クーポンを延長する</h1></a>
  </header>
  <article class="post-content">
    <p>GitHubにはプライベートリポジトリが無料で使える(billing planが1つ上がる)学割があります。</p>

<p><a href="https://education.github.com/">GitHub Education</a></p>

<p>申し込んでから2年が経って「もうすぐクーポン切れるよ」という内容のメールが来ました。「今も学生なので学割クーポンを延長したい」と問い合わせたところ「有効期限が切れてからもう一度WebからアプライすればOKだよ。もし学割が反映される前に次の支払が発生したら連絡してね。」とのことでした。以下、回答です。</p>

<blockquote>
  <p>If you’re still a student, you’re welcome to reapply! Check out our shiny new Education page:</p>

  <p>https://education.github.com/</p>

  <p>You might get a message about not being able to apply the new coupon. That’s because you can’t have two simultaneous coupons on your account. Once your old coupon expires, you can apply the new coupon. There’s usually a “grace period” of a few days between the expiration and the first charge, but if you do get charged before you add your new coupon, just let us know! Please don’t hesitate to let us know if you have any questions or concerns.</p>
</blockquote>

<p>あと学割が切れても既に作成してあるプライベートリポジトリはプライベートのままらしい。</p>

<blockquote class="twitter-tweet" lang="ja"><p><a href="https://twitter.com/alpaca_taichou">@alpaca_taichou</a> 突然勝手にpublicになるんですか?</p>&mdash; Kazuki Yoshida (@101kaz) <a href="https://twitter.com/101kaz/statuses/486756076776214528">2014, 7月 9</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<blockquote class="twitter-tweet" lang="ja"><p><a href="https://twitter.com/alpaca_taichou">@alpaca_taichou</a> <a href="https://twitter.com/101kaz">@101kaz</a> あれ切れてもプライベートリポジトリ保持されますよ、新しいのが作れないだけですね。</p>&mdash; Takehiro Adachi (@takehiro0740) <a href="https://twitter.com/takehiro0740/statuses/486901860544946176">2014, 7月 9</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


  </article>
  <div class="post-social">
    <div class="tweet-button"><a href="https://twitter.com/share?text=GitHub%E3%81%AE%E5%AD%A6%E5%89%B2%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3%E3%82%92%E5%BB%B6%E9%95%B7%E3%81%99%E3%82%8B%20-%20shoya.io&amp;url=http://shoya.io/blog/github_academic/"><span class="lsf" style="font-size:20px;">twitter</span> tweet
  </a></div>
    <div class="facebook-button"><a href="http://www.facebook.com/sharer.php?u=http://shoya.io/blog/github_academic/&amp;t=GitHub%E3%81%AE%E5%AD%A6%E5%89%B2%E3%82%AF%E3%83%BC%E3%83%9D%E3%83%B3%E3%82%92%E5%BB%B6%E9%95%B7%E3%81%99%E3%82%8B" onClick="window.open(encodeURI(decodeURI(this.href)), 'sharewindow', 'width=550, height=450, personalbar=0, toolbar=0, scrollbars=1, resizable=!'); return false;"><span class="lsf" style="font-size:20px;">facebook</span> share
  </a></div>
    <div class="hatenabookmark-button"><a href="http://b.hatena.ne.jp/add?mode=confirm&amp;url=http://shoya.io/blog/github_academic/"><span class="lsf" style="font-size:20px;">hatenabookmark</span> bookmark
  </a></div>
    <div class="hatena-star"><a href="http://shoya.io/blog/github_academic/" style="display: none;">hatena</a></div>
  </div>
</div>
<hr>


<div class="pagenation">
    
        <div class="page-button"><a href="/page7"></a><span class="lsf">left</span> Previous</div>
    
    
        
            <div class="page-button"><a href="/page5"></a>Next <span class="lsf">right</span></div>
        
    
</div>
        </div>
      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper-footer">
    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-3">
        <p><span class="lsf">crown</span> 人気の記事</p>
        <ul>
        
          <li>- <a href="/blog/Paletta/" class="linkedTitle">Now loading..</a></li>
        
          <li>- <a href="/blog/cookpad_internship/" class="linkedTitle">Now loading..</a></li>
        
          <li>- <a href="/blog/hatena_intern/" class="linkedTitle">Now loading..</a></li>
        
          <li>- <a href="/blog/towards-a-scientist/" class="linkedTitle">Now loading..</a></li>
        
          <li>- <a href="/blog/internet_black_market/" class="linkedTitle">Now loading..</a></li>
        
          <li>- <a href="/blog/long_shadow/" class="linkedTitle">Now loading..</a></li>
        
        </ul>
      </div>
      <div class="footer-col  footer-col-3">
        <p><span class="lsf">list</span> 最近の記事</p>
        <ul>
        
          <li>- <a href="/blog/bighero6/">「ベイマックス」観た</a></li>
        
          <li>- <a href="/blog/brain-science-for-the-mind/">「心の脳科学」読んだ</a></li>
        
          <li>- <a href="/blog/pypi/">Pythonライブラリを作成してPyPIに登録する</a></li>
        
          <li>- <a href="/blog/looking-back-at-2014/">2014年振り返り</a></li>
        
          <li>- <a href="/blog/pair-programming/">ペアプログラミングを支える技術</a></li>
        
          <li>- <a href="/blog/hakuryuen/">白龍園観覧</a></li>
        
        </ul>
      </div>
      <div class="footer-col  footer-col-1">
        <p><span class="lsf">tag</span> 記事のタグ</p>
        
        [<a href="/tag/Event/">Event</a>]
        
        [<a href="/tag/Note/">Note</a>]
        
        [<a href="/tag/ReleaseNote/">ReleaseNote</a>]
        
        [<a href="/tag/Sightseeing/">Sightseeing</a>]
        
        [<a href="/tag/Programming/">Programming</a>]
        
        [<a href="/tag/Infrastructure/">Infrastructure</a>]
        
        [<a href="/tag/Design/">Design</a>]
        
      </div>
    </div>
    <div class="footer-bio">
      <a href = "https://github.com/shoya140/"><img src="/assets/img/icon_github.png" class="footer-icon"></a>
      <a href = "https://twitter.com/shoya140/"><img src="/assets/img/icon_twitter.png" class="footer-icon"></a>
      <a href = "https://docs.google.com/forms/d/1oEXmb1m7QMJeorhI99NFCTKlXcQ0O5AP4B9qoaDmcl8/viewform"><img src="/assets/img/icon_mail.png" class="footer-icon"></a>
      <a href = "http://mrk1869.com/feed.xml"><img src="/assets/img/icon_rss.png" class="footer-icon"></a><br>
      <p>© 2014 <a href="https://plus.google.com/102413339779614193497?rel=author">Shoya Ishimaru</a></p>
    </div>
  </div>
</footer>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1918944-8']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  </body>

</html>
